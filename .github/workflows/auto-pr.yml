name: Auto Create PR

on:
  push:
    branches-ignore:
      - main

permissions:
  contents: read
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest

    steps:
      - name: Create Pull Request
        uses: actions/github-script@v7
        with:
          script: |
            const branch = context.ref.replace('refs/heads/', '');

            const { data: pulls } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: `${context.repo.owner}:${branch}`,
              base: 'main',
              state: 'open'
            });

            if (pulls.length > 0) {
              console.log('PR already exists. Skipping.');
              return;
            }

            await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `Auto PR: ${branch}`,
              head: branch,
              base: 'main',
              body: `PR criado automaticamente após push na branch **${branch}**.\n\nRevisão e merge são manuais.`
            });

            console.log('PR created successfully.');
